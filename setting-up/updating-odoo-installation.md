# 更新Odoo安装版本

本文来自[Odoo 13官方文档之开发者文档](../README.md)系列文章

## 引言

为获取最新的提升、安全修复、漏洞修正及性能提升，可能会需要不时更新Odoo的软件。

本指南仅用于在自己的托管基础设置上使用Odoo的情况。如果你使用的是Odoo的某种云方案，会自动为你执行升级操作。

与软件升级相关的用词通常很让人困惑，以下是一些基本定义：

- 更新(Odoo软件)

  代指获取当前 Odoo 版本的最新修订版的过程。例如，更新你的Odoo Enterprise 13.0到最新修订版。这并不会直接引起对Odoo数据库内容的修改，并且可通过重装此前修订版的源代码来进行取消。

- 升级 (Odoo数据库)

  表示一个复杂的数据处理操作，其中数据库的内容和结构会进行永久改变来让其与新的Odoo发行版进行兼容。这种操作是不可逆的并且通常是在你决定要切换到更新的 Odoo 发行版时由Odoo的[数据库升级服务](https://upgrade.odoo.com/)来完成。曾经这一过程也称之为“迁移”，因为它包含着在数据库内部移动数据，虽然数据库在升级后可能依然处于同一个物理空间内。

本文描述需要*更新*Odoo软件为最新版本所需要的通常步骤。如果想要了解有关升级数据库的更多信息，请访问 [Odoo升级页面 ](https://upgrade.odoo.com/)。

## 概述

更新Odoo仅需通过对当前所安装的Odoo 进行最新版本的最新安装即可。这样只要你不卸载PostgreSQL（Odoo所带的数据库引擎）会保留所有数据不进行任何修改。

升级的主要指南逻辑上参考 [安装指南](https://alanhou.org/odoo-13-installing-odoo/)，其中讲解了最常见的安装方法。

升级也最宜由最初部署Odoo的人员实施，因为其流程非常相近。

我们经常推荐下载完整的最新Odoo版本，而不单是手动应用补丁，如安全公告中所发布的补丁。这些补丁通常是提供给那些高度客制化的安装，或那样希望在测试完整升级前临时测试最小化修改的技术人员。

## 第1步: 下载已更新的Odoo版本

主要下载页面是 https://www.odoo.com/page/download。如果看到下载 Odoo 企业版的“Buy”链接，请务必使用与 Odoo 企业版订阅相关联的账号登录到Odoo.com上。

此外，你可以使用在Odoo企业版购买确认邮件中所包含的独立下载链接 。

如果通过Github进行的安装则无需下载已升级的版本 (参照下面部分)

## 第2步: 进行数据库备份

升级的流程非常安全且不修改数据。但还是推荐最好在对软件执行修改前进行完整的数据库备份，并保存在另一台电脑上一个安全的地方。

如果未禁用数据库管理界面 (在 [这里](#security)查看为什么应禁用),，则可以使用它 (在数据库选择界面的下方链接) 来下载数据库备份。如果进行了禁用，使用和日常备份桢的流程。

## 第3步: 安装更新版本

选择与当前安装相匹配的方法：

### 包安装器

如果使用从官网下载的安装包进行的Odoo安装（推荐方法），升级非常之简单。你只需要下载与系统相对应的安装包（参见第1步）并在服务器上进行安装即可。它会按日进行更新并包含最新的漏洞修复。通常，你只需在当前软件的顶部双击包来进行安装。在安装该包之后，确保要重启Odoo服务或在准备妥当的情况下重启服务器。

### 源码安装(Tarball)

如果你最初是通过“tarball”版本（源码存档）进行的Odoo安装，则需替换安装路径为新的版本。首先从Odoo.com下载最新的 tarball。它会按日进行更新并包含最新的漏洞修复（参见第1步）。在下载完包之后，将其解压到服务器的临时位置中。

你将获取到一个带有源码版本标记的文件夹，例如“odoo-13.0+e.20190719”，其中包含一个“odoo.egg-info”文件夹并实际源码文件夹名为 “odoo” (Odoo 10及此后版本)或针对老版本名为“openerp”。可以忽略这个odoo.egg-info文件夹。定位到当前软件部署所在的文件夹，交将其替换为你刚刚解压的新的“odoo” 或 “openerp”文件夹。

确保要匹配文件夹布局，例如在新源码中所含的“addons”文件夹应与之前的路径完全一致。其次注意任意你在老文件夹中手动拷贝或修改的配置文件，将它们拷贝到亲的文件夹中。最后，重启Odoo服务或在准备妥当的情况下重启服务器。

### 源码安装(Github)

如果最初是通过对Github上的官方仓库进行完整克隆来完成安装的话，更新过程仅需你通过git拉取最新的源代码。进入各仓库的路径(主Odoo仓库，及企业版仓库)，并运行如下命令：

```
git fetch 
git rebase --autostash
```

如果在本地编辑过Odoo源代码的话最后那条命令可能会碰到源码冲突。错误消息会给出冲突的文件列表，你需要手动处理这些冲突，通过对它们进行编辑来决定保留哪一部分的代码。

而如果你倾向于抛弃所有的冲突修改，恢复为官方版本的话，可以使用如下命令：

```
git reset --hard
```

最后，重启Odoo服务或重启服务器，一切应当会就绪了。

### Docker

请参见我们的 [Docker镜像文档](https://hub.docker.com/_/odoo/)了解最体的升级指南。